!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{getPosition(t,e,i){let s=this.size/i;return[this.left+e*s,this.top+t*s]}waitForImageLoad(){return this.texture=new Image,this.texture.src="/img/"+this.img,this.texture.complete?Promise.resolve():new Promise((t,e)=>{this.texture.onload=e=>{t()},this.texture.onerror=e})}}class n{constructor(t){this.running=!1,this.a=null,this.update=t}run(){this.running=!0,this.a=t=>{this.update(t),this.running&&requestAnimationFrame(this.a)},requestAnimationFrame(this.a)}stop(){this.running=!1,this.a=null}}const h=.01;function o(t,e){return Math.abs(t-e)<h}function r(t,e,i,s){return Math.floor((t-i)/(e/s))}function l(t,e,i,s,n,h){return[r(e,i,n,h),r(t,i,s,h)]}function a(t,e,i,s,n,h){let o=i/h;return[s+e*o,n+t*o]}const c=30;class u{constructor(t,e,i,s,n,h){this.velX=0,this.velY=0,this._destX=null,this._destY=null,this.tag=t,this.texture=e,this.sx=i,this.sy=s,this.srcSize=n,this.size=h}nearX(){let t=this._destX-this.x;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velX)}nearY(){let t=this._destY-this.y;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velY)}set destX(t){this._destX=t,null!=t&&(this.nearX()?(this._destX=null,this.x=t,this.velX=0):this.velX=c*Math.sign(t-this.x))}set destY(t){this._destY=t,null!=t&&(this.nearY()?(this._destY=null,this.y=t,this.velY=0):this.velY=c*Math.sign(t-this.y))}evaluatePosition(t,e,i,s){let n,h;return 0==this.velX?n=r(this.x+this.size/2,i,t,s):(n=r(this.x,i,t,s),o(t+n*this.size,this.x)?n+=Math.sign(this.velX):this.velX>0&&(n+=1),n=Math.max(0,Math.min(n,i/s-1))),0==this.velY?h=r(this.y+this.size/2,i,e,s):(h=r(this.y,i,e,s),o(e+h*this.size,this.y)?h+=Math.sign(this.velY):this.velY>0&&(h+=1),h=Math.max(0,Math.min(h,i/s-1))),[h,n]}whereami(t,e,i,s){return l(this.x+this.size/2,this.y+this.size/2,i,t,e,s)}update(t){null!=this._destX&&this.nearX()&&(this.x=this._destX,this._destX=null,this.velX&&t.createSpark(this.x,this.y,"h",-Math.sign(this.velX)),this.velX=0),null!=this._destY&&this.nearY()&&(this.y=this._destY,this._destY=null,this.velY&&t.createSpark(this.x,this.y,"v",-Math.sign(this.velY)),this.velY=0),this.x+=this.velX,this.y+=this.velY,this.x<t.left?(this.x=t.left,this.velX=0):this.x+this.size>t.right&&(this.x=t.right-this.size,this.velX=0),this.y<t.top?(this.y=t.top,this.velY=0):this.y+this.size>t.bottom&&(this.y=t.bottom-this.size,this.velY=0)}render(t,e=!0){if(t.fillStyle="white",t.lineWidth=.5,t.drawImage(this.texture,this.sx,this.sy,this.srcSize,this.srcSize,this.x,this.y,this.size,this.size),t.strokeRect(this.x,this.y,this.size,this.size),e){let e=Math.floor(this.size/3);t.font=e+'px "Exo 2"',t.lineWidth=5;let{width:i}=t.measureText(this.label),s=this.x+i/2+4,n=this.y+this.size/6+2;t.strokeText(this.label,s,n),t.fillText(this.label,s,n)}}getIntoPositionNow(t){null!=this._destX&&(this.x=this._destX,this._destX=null,this.velX&&t.createSpark(this.x,this.y,"h",-Math.sign(this.velX)),this.velX=0),null!=this._destY&&(this.y=this._destY,this._destY=null,this.velY&&t.createSpark(this.x,this.y,"v",-Math.sign(this.velY)),this.velY=0)}}function d(t,e,i){if(t==e)return!1;let s,n,h,o;if("h"==i)s=Math.min(t.x,t.x+t.velX),n=Math.max(t.x+t.size,t.x+t.size+t.velX),h=Math.min(e.x,e.x+e.velX),o=Math.max(e.x+e.size,e.x+e.size+e.velX);else{if("v"!=i)return!1;s=Math.min(t.y,t.y+t.velY),n=Math.max(t.y+t.size,t.y+t.size+t.velY),h=Math.min(e.y,e.y+e.velY),o=Math.max(e.y+e.size,e.y+e.size+e.velY)}return s<o&&h<n}const p=31;class f{constructor(){this.piece=null,this.row=null,this.col=null,this.pieceOffsetX=null,this.pieceOffsetY=null,this.concern=[],this.moveAxis=null}onMousedown(t,e){let{startX:i,startY:s}=t,[n,h]=e.rowColOfBlank,[o,r]=e.getRowColAt(i,s);n==o?(this.moveAxis="h",this.concern=e.getVector(n,"row")):h==r&&(this.moveAxis="v",this.concern=e.getVector(h,"col")),this.row=o,this.col=r,this.piece=e.getPieceAt(o,r),this.pieceOffsetX=i-this.piece.x,this.pieceOffsetY=s-this.piece.y}onMouseup(t,e){let{startX:i,startY:s,endX:n,endY:h,startTime:o,endTime:r}=t,l="h"==this.moveAxis?n-i:h-s;r-o<300&&Math.abs(l)<p?this.updateModelThenView(e):this.updateModelByView(e),this.piece=null,this.moveAxis=null}updateModelThenView(t){const e=[],i="h"==this.moveAxis?this.row*t.size:this.col,s="h"==this.moveAxis?1:t.size;for(let n=0;n<t.size;n++){let h=i+s*n;e[n]=t.puzzleModel[h]}const n=this.piece.tag,h=e.indexOf(n),o=e.indexOf(t.blankTag);e.splice(o,1),e.splice(h,0,t.blankTag);for(let n=0;n<t.size;n++){let h=i+s*n;t.puzzleModel[h]=e[n];let o=t.pieces[e[n]],[r,l]=[Math.floor(h/t.size),h%t.size],[c,u]=a(r,l,t.len,t.left,t.top,t.size);o.destX=c,o.destY=u}}competitionPosition({left:t,top:e,len:i,size:s,blankTag:n}){let h={},o=Array(s);const[r,l]="h"==this.moveAxis?["x","velX"]:["y","velY"];for(const h of this.concern){if(h.tag==n||h==this.piece)continue;const[r,l]=h.whereami(t,e,i,s);o["h"==this.moveAxis?l:r]=h}const[a,c]=this.piece.evaluatePosition(t,e,i,s),u="h"==this.moveAxis?c:a,d=Math.sign(this.piece[l]);if(o[u]){let t=u;for(;o[t]&&t>=0&&t<s;)t+=d;if(t>=0&&t<s){for(let e=t;e!=u;e-=d)o[e]=o[e-d];o[u]=this.piece}else o[u-d]=this.piece}else o[u]=this.piece;const p="h"==this.moveAxis?this.row*s:this.col,f="h"==this.moveAxis?1:s;for(let i=0;i<s;i++){let r=p+f*i;if(o[i]){const n=o[i];let l=Math.floor(r/s),a=r%s;h[r]=n.tag,n.destX=t+a*n.size,n.destY=e+l*n.size}else h[r]=n}return h}staticPosition({left:t,top:e,len:i,size:s,blankTag:n}){let h={};for(const o of this.concern){if(o.tag==n)continue;let[r,l]=o.whereami(t,e,i,s);h[r*s+l]=o.tag,o.destX=t+l*o.size,o.destY=e+r*o.size}const o="h"==this.moveAxis?this.row*s:this.col,r="h"==this.moveAxis?1:s;for(let t=0;t<s;t++){let e=o+r*t;if(!(e in h)){h[e]=n;break}}return h}updateModelByView(t){let e=this.competitionPosition(t);for(const i in e){const s=e[i];t.puzzleModel[i]=s}}update(t,e){if("h"==this.moveAxis&&null!=e.beforeX){let t=e.x-this.pieceOffsetX;this.piece.velX=t-this.piece.x}else if("v"==this.moveAxis&&null!=e.beforeY){let t=e.y-this.pieceOffsetY;this.piece.velY=t-this.piece.y}this.resolveCollision(t)}resolveCollision(t){const e=t.blankTag,i=this.concern.length,s="h"==this.moveAxis?this.col:this.row,[n,h]="h"==this.moveAxis?["x","velX"]:["y","velY"],o=this.piece[h],r=Math.sign(o);if(0!=r){for(let t=s;t>=0&&t<i;t+=r){const s=this.concern[t];if(s.tag!=e)for(let o=t+r;o>=0&&o<i;o+=r){const t=this.concern[o];t.tag!=e&&(d(s,t,this.moveAxis)&&(t[n]=s[n]+s[h]+t.size*r))}}let o;o="h"==this.moveAxis?r<0?t.left:t.right-this.piece.size:r<0?t.top:t.bottom-this.piece.size;const[l,a]=r<0?[0,i]:[i-1,-1];for(let e=l;e!=a;e-=r){if(this.concern[e].tag==t.blankTag)continue;const i=this.concern[e];(i[n]+i[h]-o)*r>0&&(i[n]=o,i[h]=0,o+=this.piece.size*-r)}}}}class m{constructor(t,e,i){this.startTime=null,this.endTime=null,this.currentTime=0,this.y=i/2,this.left=t,this.width=e,this.height=i}set width(t){this._width=t,this.w_3=t/3,this.w_6=t/6,this.p=this.w_6-t/25,this.q=this.w_6+t/25}set height(t){this._height=t,this.fontSize=t-1}start(t){this.startTime=t,this.endTime=null}end(t){this.endTime=t}reset(){this.startTime=null,this.endTime=null,this.currentTime=null}update(t){this.currentTime=t}render(t){let{y:e,left:i,w_3:s,w_6:n,p:h,q:o}=this;t.clearRect(i,0,this._width,this._height),t.font=this.fontSize+'px "Exo 2"';let[r,l,a]=function(t){let e=Math.round(t/10),i=Math.floor(e/6e3),s=(e%6e3).toString(),n=s.length;if(n<4){let t=Array(4-n);t.fill("0"),s=t.join("")+s}let h=i.toString(),o=h.length;if(o<2){let t=Array(2-o);t.fill("0"),h=t.join("")+h}return[h,s.substr(0,2),s.substr(2,2)]}(this.currentTime-this.startTime);t.lineWidth=4,t.textAlign="center",t.strokeText(r,i+n,e),t.strokeText("'",i+s,e),t.strokeText('"',i+2*s,e),t.fillText(r,i+n,e),t.fillText("'",i+s,e),t.fillText('"',i+2*s,e),t.textAlign="right",t.strokeText(l[0],i+s+n,e),t.strokeText(a[0],i+2*s+n,e),t.fillText(l[0],i+s+n,e),t.fillText(a[0],i+2*s+n,e),t.textAlign="left",t.strokeText(l[1],i+s+n,e),t.strokeText(a[1],i+2*s+n,e),t.fillText(l[1],i+s+n,e),t.fillText(a[1],i+2*s+n,e)}}const g=20,v=20,z=.75,y=.125,x=50,b=15,w=50,M=25,_=1,k=0;class X{constructor(t,e,i,s,n){this.life=g,this.x=t,this.y=e,this.len=i,this.axis=s,this.direction=n;const h=Math.floor(i/10);let[o,r]="h"==s?[n*v,0]:[0,n*v];this.particles=Array.from(Array(h),()=>{let h,l,a=Math.random()*i,[c,u]="h"==s?[t+n*v,e+a]:[t+a,e+n*v];return"h"==s?(h=o+(Math.random()-.5)*v*1.5,l=r+(a-i/2)/5):(h=o+(a-i/2)/5,l=r+(Math.random()-.5)*v*1.5),{x:c,y:u,velX:h,velY:l}})}update(t){for(const t of this.particles)t.x+=t.velX,t.y+=t.velY,t.velY+=z,t.velX-=Math.sign(t.velX)*y;this.life--}renderParticles(t){const e=t.strokeStyle,i=t.lineCap;t.strokeStyle=function(t){let e=1-t/g;return`hsl(${x+(b-x)*e}, 100%, ${w+(M-w)*e}%, ${_+(k-_)*e})`}(this.life),t.lineWidth=5,t.lineCap="round";for(const e of this.particles){const{x:i,y:s,velX:n,velY:h}=e;t.beginPath(),t.moveTo(i,s),t.lineTo(i-2*n,s-2*h),t.stroke()}t.strokeStyle=e,t.lineCap=i}renderFireball(t){const e=t.fillStyle;let i=this.x,s=this.y,n=Math.abs(this.life/g),h=n*n*this.direction*this.len/4,o="h"==this.axis?t.createLinearGradient(i+h,s,i,s):t.createLinearGradient(i,s+h,i,s);o.addColorStop(0,"#000000"),o.addColorStop(.3,"#884310"),o.addColorStop(.7,"#FFCE58"),o.addColorStop(1,"#FFFFFF"),t.fillStyle=o,"h"==this.axis?t.fillRect(i,s,h,this.len):t.fillRect(i,s,this.len,h),t.fillStyle=e}render(t){t.globalCompositeOperation="screen",this.renderParticles(t),this.renderFireball(t),t.globalCompositeOperation="source-over"}get invalid(){return this.life<0}}function T(t,e){for(;;){let i=Math.floor(Math.random()*t.length);if(t[i]!=e)return i}}function Y(t,e){let i=t.indexOf(e),s=Math.sqrt(t.length),n=Math.floor(i/s),h=0;for(let i=0;i<t.length;i++)if(t[i]!=e)for(let s=i+1;s<t.length;s++)t[s]!=e&&t[i]>t[s]&&h++;return(h+(s%2==0?n+1:0))%2==0}class S{constructor(t,e,i,s,n,h,o){this.playing=!1,this.blankTag=0,this.showLabel=!1,this._bottomBlank=!0,this._rightBlank=!1,this._upsideDown=!1,this.grab=new f,this.sprites=[],this.handlePlay=this._noop,this.completeHandlers=[],this.left=i,this.top=s,this.len=n,this.timer=new m(i,h,o),this.viewWidth=2*i+n,this.viewHeight=2*s+n+o,this._size=t,this.setPuzzleSet(e)}get right(){return this.left+this.len}get bottom(){return this.top+this.len}get size(){return this._size}get pieceSize(){return this.len/this._size}get rowColOfBlank(){let t=this.puzzleModel.indexOf(this.blankTag);return[Math.floor(t/this._size),t%this._size]}assignLabel(t){this._upsideDown=t;const e=this._size*this._size;for(let i=0;i<e;i++){let e=Math.floor(i/this._size),s=i%this._size,n=(t?this._size-e-1:e)*this._size+s+1;this.pieces[i].label=n.toString()}}setSize(t,e,i){this.end(null),this.timer.reset(),this._size=t,this._bottomBlank=e,this._rightBlank=i;const s=t*t;this.puzzleModel=new Array(s),this.pieces=new Array(s);const n=this._puzzleSet.size/t;for(let e=0;e<s;e++){this.puzzleModel[e]=e;let i=Math.floor(e/t),s=e%t,[h,o]=a(i,s,this._puzzleSet.size,this._puzzleSet.left,this._puzzleSet.top,t);this.pieces[e]=new u(e,this._puzzleSet.texture,h,o,n,this.len/t)}this.blankTag=this._size*(this._size-1)*Number(e)+(this._size-1)*Number(i),this.assignLabel(this._upsideDown),this.initPiecePosition()}setPuzzleSet(t){this._puzzleSet=t,this.solvable=t.solvable,this.setSize(this._size,this._bottomBlank,this._rightBlank)}shuffle(){do{if(this.puzzleModel.sort(()=>.5-Math.random()),Y(this.puzzleModel,this.blankTag)!=this.solvable){let t,e=T(this.puzzleModel,this.blankTag);do{t=T(this.puzzleModel,this.blankTag)}while(e==t);let i=this.puzzleModel[e];this.puzzleModel[e]=this.puzzleModel[t],this.puzzleModel[t]=i}}while(this.isSolved())}initPiecePosition(){const t=this._size*this._size,e=this._size,i=this.len;for(let s=0;s<t;s++){const t=this.puzzleModel[s];let n=Math.floor(s/e),h=s%e,o=this.pieces[t];o.x=this.left+h*i/e,o.y=this.top+n*i/e,o.destX=null,o.destY=null,o.velX=0,o.velY=0}}getRowColAt(t,e){return l(t,e,this.len,this.left,this.top,this._size)}getPieceAt(t,e){let i=e+t*this._size,s=this.puzzleModel[i];return this.pieces[s]}getVector(t,e){let i,s,n=new Array(this._size);switch(e){case"row":i=t*this._size,s=1;break;case"col":i=t,s=this._size}for(let t=0;t<this._size;t++)n[t]=this.pieces[this.puzzleModel[i+s*t]];return n}createSpark(t,e,i,s){const n=this.len/this.size;-1==s&&("h"==i?t+=n:"v"==i&&(e+=n)),this.sprites.push(new X(t,e,n,i,s))}acceptCoordinate(t,e){if(t<this.left||t>this.right||e<this.top||e>this.bottom)return!1;let[i,s]=this.rowColOfBlank,[n,h]=this.getRowColAt(t,e);return i==n!=(s==h)}dispatchMousedown(t){this.grab.onMousedown(t,this);for(const t of this.pieces)t.tag!=this.blankTag&&t.getIntoPositionNow(this)}dispatchTouchstart(t){this.grab.onMousedown(t,this);for(const t of this.pieces)t.tag!=this.blankTag&&t.getIntoPositionNow(this)}dispatchMouseup(t){this.grab.onMouseup(t,this)}dispatchTouchend(t){this.grab.onMouseup(t,this)}_noop(){}_updateForPlaying(t){this.isSolved()?this.onComplete(t):this.timer.update(t)}start(t){this.handlePlay=this._updateForPlaying,this.playing=!0,this.timer.start(t)}end(t){this.handlePlay=this._noop,this.playing=!1,this.timer.end(t)}checkBeforeEnd(){return!this.playing||window.confirm("설정을 변경하면 현재 진행 중인 게임이 종료됩니다.\n게임을 중단하고 설정을 변경할까요?")}isSolved(){for(let t=0;t<this.puzzleModel.length;t++)if(this.puzzleModel[t]!=t)return!1;return!0}onComplete(t){this.end(t);for(const t of this.completeHandlers)t()}update(t,e){this.handlePlay(t),this.grab.piece&&e&&this.grab.update(this,e);for(const t of this.grab.concern)t.tag!=this.blankTag&&t.update(this);for(let t=0;t<this.sprites.length;t++){const e=this.sprites[t];e.update(this),e.invalid&&(this.sprites.splice(t,1),t--)}}render(t){t.clearRect(0,0,this.viewWidth,this.viewHeight);for(const e of this.pieces)e.tag!=this.blankTag&&e.render(t,this.showLabel);for(const e of this.sprites)e.render(t)}}class E{get x(){return this.currentX}get y(){return this.currentY}get beforeX(){return this._beforeX}get beforeY(){return this._beforeY}get moveX(){return null!=this.beforeX&&null!=this.currentX?this.currentX-this._beforeX:0}get moveY(){return null!=this.beforeY&&null!=this.currentY?this.currentY-this._beforeY:0}input(t,e){this.inputX=t,this.inputY=e}shim(t,e){this.currentX=t,this.currentY=e}pulse(){this._beforeX=this.currentX,this._beforeY=this.currentY,this.currentX=this.inputX,this.currentY=this.inputY}}class L{disconnect(){document.removeEventListener("mousedown",this.mouse),document.removeEventListener("touchstart",this.touch)}open(){this.mouse=t=>{this.whenItsMouse(t),this.disconnect()},this.touch=t=>{this.whenItsTouch(t),this.disconnect()},document.addEventListener("mousedown",this.mouse),document.addEventListener("touchstart",this.touch)}}class B{constructor(){this.messageQueue=[],this.messageCache=[],this.scale=1,this.coordinate=new E,this.mousedown=t=>{t.preventDefault();let e=t.offsetX*this.scale,i=t.offsetY*this.scale;return this.onstart(e,i,t.timeStamp,t.button),!1},this.mousemove=t=>{this.coordinate.input(t.offsetX*this.scale,t.offsetY*this.scale)},this.mouseup=t=>{let e=t.offsetX*this.scale,i=t.offsetY*this.scale,s=this.messageCache[t.button];delete this.messageCache[t.button],s.endX=e,s.endY=i,s.endTime=t.timeStamp,this.messageQueue.push(s),this.coordinate.input(e,i),this.source.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)}}onstart(t,e,i,s){this.listener.acceptCoordinate(t,e)&&(this.coordinate.shim(t,e),this.coordinate.input(t,e),this.source.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup),this.messageQueue.push({type:"mousedown",id:s,startX:t,startY:e,startTime:i}),this.messageCache[s]={type:"mouseup",id:s,startX:t,startY:e,startTime:i})}invokeStart(t){this.mousedown(t)}connect(t,e){this.disconnect(),this.source=t,this.listener=e,this.source.addEventListener("mousedown",this.mousedown)}disconnect(){let t=this.source;t&&(t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)),this.source=null,this.listener=null}update(){let t;for(;null!=(t=this.messageQueue.shift());)switch(t.type){case"mousedown":this.listener.dispatchMousedown(t);break;case"mouseup":this.listener.dispatchMouseup(t)}this.coordinate.pulse()}}class P{constructor(){this.messageQueue=[],this.messageCache=[],this.touchStateMap=[],this.coord=null,this.scale=1,this.touchstart=t=>{t.preventDefault();let e=t.changedTouches;for(const i of e){let e=(i.pageX-this.sourceLeft)*this.scale,s=(i.pageY-this.sourceTop)*this.scale;this.onstart(e,s,t.timeStamp,i.identifier)}return!1},this.touchmove=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const t=this.touchStateMap[e.identifier];let i=(e.pageX-this.sourceLeft)*this.scale,s=(e.pageY-this.sourceTop)*this.scale;t.input(i,s)}},this.touchend=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const i=this.touchStateMap[e.identifier],s=(e.pageX-this.sourceLeft)*this.scale,n=(e.pageY-this.sourceTop)*this.scale,h=this.messageCache[e.identifier];if(delete this.messageCache[e.identifier],h.endX=s,h.endY=n,h.endTime=t.timeStamp,this.messageQueue.push(h),i.input(s,n),delete this.touchStateMap[e.identifier],this.coord==i){this.coord=null;for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.coord=this.touchStateMap[t];break}}}}}get coordinate(){return this.coord}onstart(t,e,i,s){if(this.listener.acceptCoordinate(t,e)){let n=new E;n.input(t,e),n.shim(t,e),this.touchStateMap[s]=n,this.coord||(this.coord=n),this.messageQueue.push({type:"touchstart",id:s,startX:t,startY:e,startTime:i}),this.messageCache[s]={type:"touchend",id:s,startX:t,startY:e,startTime:i}}}invokeStart(t){this.touchstart(t)}connect(t,e){this.disconnect(),this.source=t,this.listener=e,this.source.addEventListener("touchstart",this.touchstart),this.source.addEventListener("touchmove",this.touchmove),document.addEventListener("touchend",this.touchend);let{left:i,top:s}=t.getBoundingClientRect();this.sourceLeft=i,this.sourceTop=s}disconnect(){let t=this.source;t&&(t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)),this.source=null,this.listener=null}update(){let t;for(;null!=(t=this.messageQueue.shift());)switch(t.type){case"touchstart":this.listener.dispatchTouchstart(t);break;case"touchend":this.listener.dispatchTouchend(t)}for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.touchStateMap[t].pulse()}}}var A=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{l(s.next(t))}catch(t){h(t)}}function r(t){try{l(s.throw(t))}catch(t){h(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((s=s.apply(t,e||[])).next())}))};let C,I,O,F,R,D;const j=document.getElementById("start"),Q=document.getElementById("stop"),N=document.getElementById("next"),V=document.getElementById("random"),W=document.getElementById("puzzle-preview"),q=document.getElementById("game-canvas"),H=document.getElementById("preview-canvas"),$=document.getElementById("timer-canvas"),G=q.getContext("2d"),J=H.getContext("2d"),K=$.getContext("2d"),U=q.width-40,Z=$.width-40,tt=$.height,et=document.getElementById("story");G.textAlign="center",G.textBaseline="middle",K.textBaseline="middle",K.fillStyle="#FFFFFF";const it=document.getElementById("config"),st=document.getElementById("article");document.getElementById("show-config").addEventListener("click",t=>{it.hidden=!it.hidden}),document.getElementById("config-close").addEventListener("click",t=>{it.hidden=!0}),document.getElementById("show-info").addEventListener("click",t=>{window.scrollTo({top:st.getBoundingClientRect().top-20,behavior:"smooth"})});const nt=document.getElementById("size-decrease"),ht=document.getElementById("size-increase"),ot=document.getElementById("size-view");let rt=3;const lt=document.getElementById("puzzle-selector"),at={topLeft:document.getElementById("blank-pos-top-left"),topRight:document.getElementById("blank-pos-top-right"),bottomLeft:document.getElementById("blank-pos-bottom-left"),bottomRight:document.getElementById("blank-pos-bottom-right")};function ct(){return[at.bottomLeft.checked||at.bottomRight.checked,at.topRight.checked||at.bottomRight.checked]}const ut={none:document.getElementById("show-label-none"),phone:document.getElementById("show-label-phone"),keypad:document.getElementById("show-label-keypad")};function dt(){j.hidden=!1,j.innerText="시작하기",Q.hidden=!0,N.hidden=!0,V.hidden=!1}function pt(){j.hidden=!1,j.innerText="다시하기",Q.hidden=!0,N.hidden=!1,V.hidden=!1}function ft({texture:t,left:e,top:i,size:s}){let{width:n,height:h}=H;J.clearRect(0,0,n,h),J.drawImage(t,e,i,s,s,0,0,n,h)}function mt(){W.hidden=!0,et.hidden=!1,R&&(et.innerText=R.story)}function gt(){W.hidden=!1,et.hidden=!0}function vt(t,e,i){C.setSize(t,e,i),dt(),gt()}function zt(t){if(!C.checkBeforeEnd())return t.preventDefault(),!1;vt(rt,...ct())}function yt(t){C.end(null),C.shuffle(),C.initPiecePosition(),C.start(t),j.hidden=!0,Q.hidden=!1,N.hidden=!0,V.hidden=!0,gt()}(function(){return A(this,void 0,void 0,(function*(){const t=[],e=yield fetch("puzzleset.json"),i=yield e.json();for(let e=0;e<i.length;e++){const n=i[e];n.__proto__=s.prototype,t.push(n);const h=document.createElement("option");h.value=e.toString(),h.innerText=n.title,lt.appendChild(h)}return yield Promise.all(t.map(t=>t.waitForImageLoad())),t}))})().then(t=>{D=t,j.addEventListener("click",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;yt(t.timeStamp)}),Q.addEventListener("click",t=>{C.end(t.timeStamp),dt()}),N.addEventListener("click",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;!function(t){let e=Number(lt.value);do{e=(e+1)%lt.length,R=D[e]}while(!R.solvable);lt.value=e.toString()}(),C.setPuzzleSet(R),ft(R),yt(t.timeStamp)}),V.addEventListener("click",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;!function(t){let e,i=Number(lt.value);do{e=Math.floor(Math.random()*lt.length),R=D[e]}while(!R.solvable||i==e);lt.value=e.toString()}(),C.setPuzzleSet(R),ft(R),yt(t.timeStamp)}),at.topLeft.addEventListener("input",zt),at.topRight.addEventListener("input",zt),at.bottomLeft.addEventListener("input",zt),at.bottomRight.addEventListener("input",zt),nt.addEventListener("click",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;rt-=1,ht.disabled=!1,ot.innerText=rt.toString(),3==rt&&(nt.disabled=!0),vt(rt,...ct())}),ht.addEventListener("click",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;rt+=1,nt.disabled=!1,ot.innerText=rt.toString(),9==rt&&(ht.disabled=!0),vt(rt,...ct())}),lt.addEventListener("change",t=>{if(!C.checkBeforeEnd())return t.preventDefault(),!1;R=D[lt.value],C.setPuzzleSet(R),ft(R),dt(),gt()}),ut.none.addEventListener("input",t=>{C.showLabel=!1}),ut.phone.addEventListener("input",t=>{C.showLabel=!0,C.assignLabel(!1)}),ut.keypad.addEventListener("input",t=>{C.showLabel=!0,C.assignLabel(!0)}),R=t[lt.value],C=new S(rt,R,20,20,U,Z,tt),C.completeHandlers.push(pt,mt),ft(R);let e=q.width/q.getBoundingClientRect().width;I=new n(t=>{C.update(t),C.render(G),C.timer.render(K)});let i=t=>{F.update(),C.update(t,F.coordinate),C.render(G),C.timer.render(K)};I.run(),O=new L,O.whenItsMouse=t=>{F=new B,F.scale=e,F.connect(q,C),I.update=i,t.target==q&&F.invokeStart(t)},O.whenItsTouch=t=>{F=new P,F.scale=e,F.connect(q,C),I.update=i,t.target==q&&F.invokeStart(t)},O.open()})}]);