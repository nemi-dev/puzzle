!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{getPosition(t,e,i){let s=this.size/i;return[this.left+e*s,this.top+t*s]}waitForImageLoad(){return this.texture=new Image,this.texture.src="/img/"+this.img,this.texture.complete?Promise.resolve():new Promise((t,e)=>{this.texture.onload=e=>{t()},this.texture.onerror=e})}}class h{constructor(t){this.running=!1,this.a=null,this.update=t}run(){this.running=!0,this.a=t=>{this.update(t),this.running&&requestAnimationFrame(this.a)},requestAnimationFrame(this.a)}stop(){this.running=!1,this.a=null}}const n=.01;function o(t,e){return Math.abs(t-e)<n}function l(t,e,i,s){return Math.floor((t-i)/(e/s))}function r(t,e,i,s,h,n){return[l(e,i,h,n),l(t,i,s,n)]}function a(t,e,i,s,h,n){let o=i/n;return[s+e*o,h+t*o]}const c=30;class u{constructor(t,e,i,s,h,n){this.velX=0,this.velY=0,this._destX=null,this._destY=null,this.tag=t,this.texture=e,this.sx=i,this.sy=s,this.srcSize=h,this.size=n}nearX(){let t=this._destX-this.x;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velX)}nearY(){let t=this._destY-this.y;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velY)}set destX(t){this._destX=t,null!=t&&(this.nearX()?(this._destX=null,this.x=t,this.velX=0):this.velX=c*Math.sign(t-this.x))}set destY(t){this._destY=t,null!=t&&(this.nearY()?(this._destY=null,this.y=t,this.velY=0):this.velY=c*Math.sign(t-this.y))}evaluatePosition(t,e,i,s){let h,n;return 0==this.velX?h=l(this.x+this.size/2,i,t,s):(h=l(this.x,i,t,s),o(t+h*this.size,this.x)?h+=Math.sign(this.velX):this.velX>0&&(h+=1),h=Math.max(0,Math.min(h,i/s-1))),0==this.velY?n=l(this.y+this.size/2,i,e,s):(n=l(this.y,i,e,s),o(e+n*this.size,this.y)?n+=Math.sign(this.velY):this.velY>0&&(n+=1),n=Math.max(0,Math.min(n,i/s-1))),[n,h]}whereami(t,e,i,s){return r(this.x+this.size/2,this.y+this.size/2,i,t,e,s)}update(t){if(null!=this._destX&&this.nearX()){if(this.x=this._destX,this._destX=null,this.velX){let e=this.x;this.velX>0&&(e+=this.size),t.createSpark(e,this.y,"h",-Math.sign(this.velX))}this.velX=0}if(null!=this._destY&&this.nearY()){if(this.y=this._destY,this._destY=null,this.velY){let e=this.y;this.velY>0&&(e+=this.size),t.createSpark(this.x,e,"v",-Math.sign(this.velY))}this.velY=0}this.x+=this.velX,this.y+=this.velY,this.x<t.left?(this.x=t.left,this.velX=0):this.x+this.size>t.right&&(this.x=t.right-this.size,this.velX=0),this.y<t.top?(this.y=t.top,this.velY=0):this.y+this.size>t.bottom&&(this.y=t.bottom-this.size,this.velY=0)}render(t,e=!0){if(t.fillStyle="white",t.lineWidth=1,t.strokeRect(this.x,this.y,this.size,this.size),t.drawImage(this.texture,this.sx,this.sy,this.srcSize,this.srcSize,this.x,this.y,this.size,this.size),e){let e=Math.floor(this.size/3);t.font=e+'px "Exo 2"',t.lineWidth=3;let{width:i}=t.measureText(this.label),s=this.x+i/2+4,h=this.y+this.size/6+2;t.strokeText(this.label,s,h),t.fillText(this.label,s,h)}}getIntoPositionNow(t){if(null!=this._destX){if(this.x=this._destX,this._destX=null,this.velX){let e=this.x;this.velX>0&&(e+=this.size),t.createSpark(e,this.y,"h",-Math.sign(this.velX))}this.velX=0}if(null!=this._destY){if(this.y=this._destY,this._destY=null,this.velY){let e=this.y;this.velY>0&&(e+=this.size),t.createSpark(this.x,e,"v",-Math.sign(this.velY))}this.velY=0}}}function d(t,e,i){if(t==e)return!1;let s,h,n,o;if("h"==i)s=Math.min(t.x,t.x+t.velX),h=Math.max(t.x+t.size,t.x+t.size+t.velX),n=Math.min(e.x,e.x+e.velX),o=Math.max(e.x+e.size,e.x+e.size+e.velX);else{if("v"!=i)return!1;s=Math.min(t.y,t.y+t.velY),h=Math.max(t.y+t.size,t.y+t.size+t.velY),n=Math.min(e.y,e.y+e.velY),o=Math.max(e.y+e.size,e.y+e.size+e.velY)}return s<o&&n<h}window.willHit=d;const f=31;class p{constructor(){this.piece=null,this.row=null,this.col=null,this.pieceOffsetX=null,this.pieceOffsetY=null,this.concern=[],this.moveAxis=null}onMousedown(t,e){let{startX:i,startY:s}=t,[h,n]=e.rowColOfBlank,[o,l]=e.getRowColAt(i,s);h==o?(this.moveAxis="h",this.concern=e.getVector(h,"row")):n==l&&(this.moveAxis="v",this.concern=e.getVector(n,"col")),this.row=o,this.col=l,this.piece=e.getPieceAt(o,l),this.pieceOffsetX=i-this.piece.x,this.pieceOffsetY=s-this.piece.y}onMouseup(t,e){let{startX:i,startY:s,endX:h,endY:n,startTime:o,endTime:l}=t,r="h"==this.moveAxis?h-i:n-s;l-o<300&&Math.abs(r)<f?this.updateModelThenView(e):this.updateModelByView(e),this.piece=null,this.moveAxis=null}updateModelThenView(t){const e=[],i="h"==this.moveAxis?this.row*t.size:this.col,s="h"==this.moveAxis?1:t.size;for(let h=0;h<t.size;h++){let n=i+s*h;e[h]=t.puzzleModel[n]}const h=this.piece.tag,n=e.indexOf(h),o=e.indexOf(t.blankTag);e.splice(o,1),e.splice(n,0,t.blankTag);for(let h=0;h<t.size;h++){let n=i+s*h;t.puzzleModel[n]=e[h];let o=t.pieces[e[h]],[l,r]=[Math.floor(n/t.size),n%t.size],[c,u]=a(l,r,t.len,t.left,t.top,t.size);o.destX=c,o.destY=u}}competitionPosition({left:t,top:e,len:i,size:s,blankTag:h}){let n={},o=Array(s);const[l,r]="h"==this.moveAxis?["x","velX"]:["y","velY"];for(const n of this.concern){if(n.tag==h||n==this.piece)continue;const[l,r]=n.whereami(t,e,i,s);o["h"==this.moveAxis?r:l]=n}const[a,c]=this.piece.evaluatePosition(t,e,i,s),u="h"==this.moveAxis?c:a,d=Math.sign(this.piece[r]);if(o[u]){let t=u;for(;o[t]&&t>=0&&t<s;)t+=d;if(t>=0&&t<s){for(let e=t;e!=u;e-=d)o[e]=o[e-d];o[u]=this.piece}else o[u-d]=this.piece}else o[u]=this.piece;const f="h"==this.moveAxis?this.row*s:this.col,p="h"==this.moveAxis?1:s;for(let i=0;i<s;i++){let l=f+p*i;if(o[i]){const h=o[i];let r=Math.floor(l/s),a=l%s;n[l]=h.tag,h.destX=t+a*h.size,h.destY=e+r*h.size}else n[l]=h}return n}staticPosition({left:t,top:e,len:i,size:s,blankTag:h}){let n={};for(const o of this.concern){if(o.tag==h)continue;let[l,r]=o.whereami(t,e,i,s);n[l*s+r]=o.tag,o.destX=t+r*o.size,o.destY=e+l*o.size}const o="h"==this.moveAxis?this.row*s:this.col,l="h"==this.moveAxis?1:s;for(let t=0;t<s;t++){let e=o+l*t;if(!(e in n)){n[e]=h;break}}return n}updateModelByView(t){let e=this.competitionPosition(t);for(const i in e){const s=e[i];t.puzzleModel[i]=s}}update(t,e){if("h"==this.moveAxis&&null!=e.beforeX){let t=e.x-this.pieceOffsetX;this.piece.velX=t-this.piece.x}else if("v"==this.moveAxis&&null!=e.beforeY){let t=e.y-this.pieceOffsetY;this.piece.velY=t-this.piece.y}this.resolveCollision(t)}resolveCollision(t){const e=t.blankTag,i=this.concern.length,s="h"==this.moveAxis?this.col:this.row,[h,n]="h"==this.moveAxis?["x","velX"]:["y","velY"],o=this.piece[n],l=Math.sign(o);if(0!=l){for(let t=s;t>=0&&t<i;t+=l){const s=this.concern[t];if(s.tag!=e)for(let o=t+l;o>=0&&o<i;o+=l){const t=this.concern[o];t.tag!=e&&(d(s,t,this.moveAxis)&&(t[h]=s[h]+s[n]+t.size*l))}}let o;o="h"==this.moveAxis?l<0?t.left:t.right-this.piece.size:l<0?t.top:t.bottom-this.piece.size;const[r,a]=l<0?[0,i]:[i-1,-1];for(let e=r;e!=a;e-=l){if(this.concern[e].tag==t.blankTag)continue;const i=this.concern[e];(i[h]+i[n]-o)*l>0&&(i[h]=o,i[n]=0,o+=this.piece.size*-l)}}}}class m{constructor(t,e,i){this.startTime=null,this.endTime=null,this.currentTime=0,this.y=i/2,this.left=t,this.width=e,this.height=i}set width(t){this._width=t,this.w_3=t/3,this.w_6=t/6,this.p=this.w_6-t/25,this.q=this.w_6+t/25}set height(t){this._height=t,this.fontSize=t-18}start(t){this.startTime=t,this.endTime=null}end(t){this.endTime=t}reset(){this.startTime=null,this.endTime=null,this.currentTime=null}update(t){this.currentTime=t}render(t){let{y:e,left:i,w_3:s,w_6:h,p:n,q:o}=this;t.clearRect(i,0,this._width,this._height),t.font=this.fontSize+'px "Exo 2"';let[l,r,a]=function(t){let e=Math.round(t/10),i=Math.floor(e/6e3),s=(e%6e3).toString(),h=s.length;if(h<4){let t=Array(4-h);t.fill("0"),s=t.join("")+s}let n=i.toString(),o=n.length;if(o<2){let t=Array(2-o);t.fill("0"),n=t.join("")+n}return[n,s.substr(0,2),s.substr(2,2)]}(this.currentTime-this.startTime);t.lineWidth=4,t.textAlign="center",t.strokeText(l,i+h,e),t.strokeText("'",i+s,e),t.strokeText('"',i+2*s,e),t.fillText(l,i+h,e),t.fillText("'",i+s,e),t.fillText('"',i+2*s,e),t.textAlign="right",t.strokeText(r[0],i+s+h,e),t.strokeText(a[0],i+2*s+h,e),t.fillText(r[0],i+s+h,e),t.fillText(a[0],i+2*s+h,e),t.textAlign="left",t.strokeText(r[1],i+s+h,e),t.strokeText(a[1],i+2*s+h,e),t.fillText(r[1],i+s+h,e),t.fillText(a[1],i+2*s+h,e)}}const g=20,v=20,z=.75,x=.125,y=50,b=15,M=50,w=25,_=1,X=0;class Y{constructor(t,e,i,s,h){this.life=g,this.x=t,this.y=e,this.len=i,this.axis=s,this.direction=h;const n=Math.floor(i/10);let[o,l]="h"==s?[h*v,0]:[0,h*v];this.particles=Array.from(Array(n),()=>{let n,r,a=Math.random()*i,[c,u]="h"==s?[t+h*v,e+a]:[t+a,e+h*v];return"h"==s?(n=o+(Math.random()-.5)*v*1.5,r=l+(a-i/2)/5):(n=o+(a-i/2)/5,r=l+(Math.random()-.5)*v*1.5),{x:c,y:u,velX:n,velY:r}})}update(t){for(const t of this.particles)t.x+=t.velX,t.y+=t.velY,t.velY+=z,t.velX-=Math.sign(t.velX)*x;this.life--}renderParticles(t){const e=t.strokeStyle,i=t.lineCap;t.strokeStyle=function(t){let e=1-t/g;return`hsl(${y+(b-y)*e}, 100%, ${M+(w-M)*e}%, ${_+(X-_)*e})`}(this.life),t.lineWidth=5,t.lineCap="round";for(const e of this.particles){const{x:i,y:s,velX:h,velY:n}=e;t.beginPath(),t.moveTo(i,s),t.lineTo(i-2*h,s-2*n),t.stroke()}t.strokeStyle=e,t.lineCap=i}renderFireball(t){const e=t.fillStyle;let i=this.x,s=this.y,h=Math.abs(this.life/g),n=h*h*this.direction*this.len/4,o="h"==this.axis?t.createLinearGradient(i+n,s,i,s):t.createLinearGradient(i,s+n,i,s);o.addColorStop(0,"#000000"),o.addColorStop(.3,"#884310"),o.addColorStop(.7,"#FFCE58"),o.addColorStop(1,"#FFFFFF"),t.fillStyle=o,"h"==this.axis?t.fillRect(i,s,n,this.len):t.fillRect(i,s,this.len,n),t.fillStyle=e}render(t){t.globalCompositeOperation="screen",this.renderParticles(t),this.renderFireball(t),t.globalCompositeOperation="source-over"}get invalid(){return this.life<0}}function S(t,e){for(;;){let i=Math.floor(Math.random()*t.length);if(t[i]!=e)return i}}function T(t,e){let i=t.indexOf(e),s=Math.sqrt(t.length),h=Math.floor(i/s),n=0;for(let i=0;i<t.length;i++)if(t[i]!=e)for(let s=i+1;s<t.length;s++)t[s]!=e&&t[i]>t[s]&&n++;return(n+(s%2==0?h+1:0))%2==0}class k{constructor(t,e,i,s,h,n){this.playing=!1,this.blankTag=0,this.showLabel=!1,this._bottomBlank=!0,this._rightBlank=!1,this._upsideDown=!1,this.grab=new p,this.sprites=[],this.handlePlay=this._noop,this.completeHandlers=[],this.left=i,this.top=s,this.len=h,this.timer=new m(i,h,n),this.viewWidth=2*i+h,this.viewHeight=2*s+h+n,this._size=t,this.setPuzzleSet(e)}get right(){return this.left+this.len}get bottom(){return this.top+this.len}get size(){return this._size}get pieceSize(){return this.len/this._size}get rowColOfBlank(){let t=this.puzzleModel.indexOf(this.blankTag);return[Math.floor(t/this._size),t%this._size]}assignLabel(t){this._upsideDown=t;const e=this._size*this._size;for(let i=0;i<e;i++){let e=Math.floor(i/this._size),s=i%this._size,h=(t?this._size-e-1:e)*this._size+s+1;this.pieces[i].label=h.toString()}}setSize(t,e,i){this.end(null),this.timer.reset(),this._size=t,this._bottomBlank=e,this._rightBlank=i;const s=t*t;this.puzzleModel=new Array(s),this.pieces=new Array(s);const h=this._puzzleSet.size/t;for(let e=0;e<s;e++){this.puzzleModel[e]=e;let i=Math.floor(e/t),s=e%t,[n,o]=a(i,s,this._puzzleSet.size,this._puzzleSet.left,this._puzzleSet.top,t);this.pieces[e]=new u(e,this._puzzleSet.texture,n,o,h,this.len/t)}this.blankTag=this._size*(this._size-1)*Number(e)+(this._size-1)*Number(i),this.assignLabel(this._upsideDown),this.initPiecePosition()}setPuzzleSet(t){this._puzzleSet=t,this.solvable=t.solvable,this.setSize(this._size,this._bottomBlank,this._rightBlank)}shuffle(){do{if(this.puzzleModel.sort(()=>.5-Math.random()),T(this.puzzleModel,this.blankTag)!=this.solvable){let t,e=S(this.puzzleModel,this.blankTag);do{t=S(this.puzzleModel,this.blankTag)}while(e==t);let i=this.puzzleModel[e];this.puzzleModel[e]=this.puzzleModel[t],this.puzzleModel[t]=i}}while(this.isSolved())}initPiecePosition(){const t=this._size*this._size,e=this._size,i=this.len;for(let s=0;s<t;s++){const t=this.puzzleModel[s];let h=Math.floor(s/e),n=s%e,o=this.pieces[t];o.x=this.left+n*i/e,o.y=this.top+h*i/e,o.destX=null,o.destY=null,o.velX=0,o.velY=0}}getRowColAt(t,e){return r(t,e,this.len,this.left,this.top,this._size)}getPieceAt(t,e){let i=e+t*this._size,s=this.puzzleModel[i];return this.pieces[s]}getVector(t,e){let i,s,h=new Array(this._size);switch(e){case"row":i=t*this._size,s=1;break;case"col":i=t,s=this._size}for(let t=0;t<this._size;t++)h[t]=this.pieces[this.puzzleModel[i+s*t]];return h}createSpark(t,e,i,s){this.sprites.push(new Y(t,e,this.len/this.size,i,s))}acceptCoordinate(t,e){if(t<this.left||t>this.right||e<this.top||e>this.bottom)return!1;let[i,s]=this.rowColOfBlank,[h,n]=this.getRowColAt(t,e);return i==h!=(s==n)}dispatchMousedown(t){this.grab.onMousedown(t,this);for(const t of this.pieces)t.tag!=this.blankTag&&t.getIntoPositionNow(this)}dispatchTouchstart(t){this.grab.onMousedown(t,this);for(const t of this.pieces)t.tag!=this.blankTag&&t.getIntoPositionNow(this)}dispatchMouseup(t){this.grab.onMouseup(t,this)}dispatchTouchend(t){this.grab.onMouseup(t,this)}_noop(){}_updateForPlaying(t){this.isSolved()?this.onComplete(t):this.timer.update(t)}start(t){this.handlePlay=this._updateForPlaying,this.playing=!0,this.timer.start(t)}end(t){this.handlePlay=this._noop,this.playing=!1,this.timer.end(t)}checkBeforeEnd(){return!this.playing||window.confirm("설정을 변경하면 현재 진행 중인 게임이 종료됩니다.\n게임을 중단하고 설정을 변경할까요?")}isSolved(){for(let t=0;t<this.puzzleModel.length;t++)if(this.puzzleModel[t]!=t)return!1;return!0}onComplete(t){this.end(t);for(const t of this.completeHandlers)t()}update(t,e){this.handlePlay(t),this.grab.piece&&this.grab.update(this,e);for(const t of this.grab.concern)t.tag!=this.blankTag&&t.update(this);for(let t=0;t<this.sprites.length;t++){const e=this.sprites[t];e.update(this),e.invalid&&(this.sprites.splice(t,1),t--)}}render(t){t.clearRect(0,0,this.viewWidth,this.viewHeight);for(const e of this.pieces)e.tag!=this.blankTag&&e.render(t,this.showLabel);for(const e of this.sprites)e.render(t)}}class E{get x(){return this.currentX}get y(){return this.currentY}get beforeX(){return this._beforeX}get beforeY(){return this._beforeY}get moveX(){return null!=this.beforeX&&null!=this.currentX?this.currentX-this._beforeX:0}get moveY(){return null!=this.beforeY&&null!=this.currentY?this.currentY-this._beforeY:0}input(t,e){this.inputX=t,this.inputY=e}shim(t,e){this.currentX=t,this.currentY=e}pulse(){this._beforeX=this.currentX,this._beforeY=this.currentY,this.currentX=this.inputX,this.currentY=this.inputY}}class P{constructor(){this.messages=[],this.messagePool=[],this.touchStateMap=[],this.coord=null,this.scale=1,this.touchstart=t=>{t.preventDefault();let e=t.changedTouches;for(const i of e){let e=(i.pageX-this.sourceLeft)*this.scale,s=(i.pageY-this.sourceTop)*this.scale;if(this.listener.acceptCoordinate(e,s)){let h=new E;h.input(e,s),h.shim(e,s),this.touchStateMap[i.identifier]=h,this.coord||(this.coord=h),this.messages.push({type:"touchstart",id:i.identifier,startX:e,startY:s,startTime:t.timeStamp}),this.messagePool[i.identifier]={type:"touchend",id:i.identifier,startX:e,startY:s,startTime:t.timeStamp}}}},this.touchmove=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const t=this.touchStateMap[e.identifier];let i=(e.pageX-this.sourceLeft)*this.scale,s=(e.pageY-this.sourceTop)*this.scale;t.input(i,s)}},this.touchend=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const i=this.touchStateMap[e.identifier],s=(e.pageX-this.sourceLeft)*this.scale,h=(e.pageY-this.sourceTop)*this.scale,n=this.messagePool[e.identifier];if(delete this.messagePool[e.identifier],n.endX=s,n.endY=h,n.endTime=t.timeStamp,this.messages.push(n),i.input(s,h),delete this.touchStateMap[e.identifier],this.coord==i){this.coord=null;for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.coord=this.touchStateMap[t];break}}}}}get coordinate(){return this.coord}connect(t,e){this.disconnect(),this.source=t,this.listener=e,this.source.addEventListener("touchstart",this.touchstart),this.source.addEventListener("touchmove",this.touchmove),document.addEventListener("touchend",this.touchend);let{left:i,top:s}=t.getBoundingClientRect();this.sourceLeft=i,this.sourceTop=s}disconnect(){let t=this.source;t&&(t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)),this.source=null,this.listener=null}update(){let t;for(;null!=(t=this.messages.shift());)switch(t.type){case"touchstart":this.listener.dispatchTouchstart(t);break;case"touchend":this.listener.dispatchTouchend(t)}for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.touchStateMap[t].pulse()}}}var A=function(t,e,i,s){return new(i||(i=Promise))((function(h,n){function o(t){try{r(s.next(t))}catch(t){n(t)}}function l(t){try{r(s.throw(t))}catch(t){n(t)}}function r(t){var e;t.done?h(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,l)}r((s=s.apply(t,e||[])).next())}))};let L,B,C,I,O;const F=document.getElementById("puzzle-preview"),R=document.getElementById("game-canvas"),j=document.getElementById("preview-canvas"),D=document.getElementById("timer-canvas"),N=R.getContext("2d"),V=j.getContext("2d"),H=D.getContext("2d"),W=document.getElementById("story");N.textAlign="center",N.textBaseline="middle",H.textAlign="center",H.textBaseline="middle",H.fillStyle="#FFFFFF";const q=20,$=20,G=R.width-2*q,J=D.height,K=document.getElementById("size"),Q=document.getElementById("puzzle-selector"),U=document.getElementById("start"),Z=document.getElementById("stop"),tt=document.getElementById("next"),et=document.getElementById("random"),it={topLeft:document.getElementById("blank-pos-top-left"),topRight:document.getElementById("blank-pos-top-right"),bottomLeft:document.getElementById("blank-pos-bottom-left"),bottomRight:document.getElementById("blank-pos-bottom-right")};const st={none:document.getElementById("show-label-none"),phone:document.getElementById("show-label-phone"),keypad:document.getElementById("show-label-keypad")};function ht(){U.hidden=!1,U.innerText="시작하기",Z.hidden=!0,tt.hidden=!0,et.hidden=!1}function nt(){U.hidden=!1,U.innerText="다시하기",Z.hidden=!0,tt.hidden=!1,et.hidden=!1}function ot({texture:t,left:e,top:i,size:s}){let{width:h,height:n}=j;V.clearRect(0,0,h,n),V.drawImage(t,e,i,s,s,q,$,h-2*q,n-2*$)}function lt(){F.hidden=!0,W.hidden=!1,I&&(W.innerText=I.story)}function rt(){F.hidden=!1,W.hidden=!0}function at(t){if(!L.checkBeforeEnd())return t.preventDefault(),!1;L.setSize(K.valueAsNumber,it.bottomLeft.checked||it.bottomRight.checked,it.topRight.checked||it.bottomRight.checked),ht(),rt()}function ct(t){L.end(null),L.shuffle(),L.initPiecePosition(),L.start(t),U.hidden=!0,Z.hidden=!1,tt.hidden=!0,et.hidden=!0,rt()}(function(){return A(this,void 0,void 0,(function*(){const t=[],e=yield fetch("puzzleset.json"),i=yield e.json();for(let e=0;e<i.length;e++){const h=i[e];h.__proto__=s.prototype,t.push(h);const n=document.createElement("option");n.value=e.toString(),n.innerText=h.title,Q.appendChild(n)}return yield Promise.all(t.map(t=>t.waitForImageLoad())),t}))})().then(t=>{O=t,U.addEventListener("click",t=>{if(!L.checkBeforeEnd())return t.preventDefault(),!1;ct(t.timeStamp)}),Z.addEventListener("click",t=>{L.end(t.timeStamp),ht()}),tt.addEventListener("click",t=>{if(!L.checkBeforeEnd())return t.preventDefault(),!1;!function(t){let e=Number(Q.value);do{e=(e+1)%Q.length,I=O[e]}while(!I.solvable);Q.value=e.toString()}(),L.setPuzzleSet(I),ot(I),ct(t.timeStamp)}),et.addEventListener("click",t=>{if(!L.checkBeforeEnd())return t.preventDefault(),!1;!function(t){let e,i=Number(Q.value);do{e=Math.floor(Math.random()*Q.length),I=O[e]}while(!I.solvable||i==e);Q.value=e.toString()}(),L.setPuzzleSet(I),ot(I),ct(t.timeStamp)}),it.topLeft.addEventListener("input",at),it.topRight.addEventListener("input",at),it.bottomLeft.addEventListener("input",at),it.bottomRight.addEventListener("input",at),K.addEventListener("change",at),Q.addEventListener("change",t=>{if(!L.checkBeforeEnd())return t.preventDefault(),!1;I=O[Q.value],L.setPuzzleSet(I),ot(I),ht(),rt()}),st.none.addEventListener("input",t=>{L.showLabel=!1}),st.phone.addEventListener("input",t=>{L.showLabel=!0,L.assignLabel(!1)}),st.keypad.addEventListener("input",t=>{L.showLabel=!0,L.assignLabel(!0)}),I=t[Q.value];let e=K.valueAsNumber,i=R.width/R.getBoundingClientRect().width;L=new k(e,I,q,$,G,J),L.completeHandlers.push(nt,lt),ot(I),C=new P,C.scale=i,C.connect(R,L),B=new h(t=>{C.update(),L.update(t,C.coordinate),L.render(N),L.timer.render(H)}),B.run(),window.game=L})}]);