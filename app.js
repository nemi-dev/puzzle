!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{getPosition(t,e,i){let s=this.size/i;return[this.left+e*s,this.top+t*s]}waitForImageLoad(){return this.texture=new Image,this.texture.src="/img/"+this.img,this.texture.complete?Promise.resolve():new Promise((t,e)=>{this.texture.onload=e=>{t()},this.texture.onerror=e})}}class n{constructor(t){this.a=null,this.update=t}start(){this.a=t=>{this.update(t),requestAnimationFrame(this.a)},requestAnimationFrame(this.a)}end(){this.a=t=>{this.a=null}}}const h=.01;function o(t,e){return Math.abs(t-e)<h}function l(t,e,i,s){return Math.floor((t-i)/(e/s))}function r(t,e,i,s,n,h){return[l(e,i,n,h),l(t,i,s,h)]}function a(t,e,i,s,n,h){let o=i/h;return[s+e*o,n+t*o]}const c=30;class d{constructor(t,e,i,s,n,h){this.velX=0,this.velY=0,this._destX=null,this._destY=null,this.tag=t,this.texture=e,this.sx=i,this.sy=s,this.srcSize=n,this.size=h}static willHit(t,e,i){if(t==e)return!1;let s,n,h,o;if("h"==i)s=Math.min(t.x,t.x+t.velX),n=Math.max(t.x+t.size,t.x+t.size+t.velX),h=Math.min(e.x,e.x+e.velX),o=Math.max(e.x+e.size,e.x+e.size+e.velX);else{if("v"!=i)return!1;s=Math.min(t.y,t.y+t.velY),n=Math.max(t.y+t.size,t.y+t.size+t.velY),h=Math.min(e.y,e.y+e.velY),o=Math.max(e.y+e.size,e.y+e.size+e.velY)}return s<o&&h<n}nearX(){let t=this._destX-this.x;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velX)}nearY(){let t=this._destY-this.y;return Math.abs(t)<c||Math.abs(t)<Math.abs(this.velY)}set destX(t){this._destX=t,null!=t&&(this.nearX()?(this._destX=null,this.x=t,this.velX=0):this.velX=c*Math.sign(t-this.x))}set destY(t){this._destY=t,null!=t&&(this.nearY()?(this._destY=null,this.y=t,this.velY=0):this.velY=c*Math.sign(t-this.y))}evaluatePosition(t,e,i,s){let n,h;return 0==this.velX?n=l(this.x+this.size/2,i,t,s):(n=l(this.x,i,t,s),o(t+n*this.size,this.x)?n+=Math.sign(this.velX):this.velX>0&&(n+=1),n=Math.max(0,Math.min(n,i/s-1))),0==this.velY?h=l(this.y+this.size/2,i,e,s):(h=l(this.y,i,e,s),o(e+h*this.size,this.y)?h+=Math.sign(this.velY):this.velY>0&&(h+=1),h=Math.max(0,Math.min(h,i/s-1))),[h,n]}whereami(t,e,i,s){return r(this.x+this.size/2,this.y+this.size/2,i,t,e,s)}update(t){null!=this._destX&&this.nearX()&&(this.x=this._destX,this._destX=null,this.velX&&t.createSpark(this.x,this.y,"h",-Math.sign(this.velX)),this.velX=0),null!=this._destY&&this.nearY()&&(this.y=this._destY,this._destY=null,this.velY&&t.createSpark(this.x,this.y,"v",-Math.sign(this.velY)),this.velY=0),this.x+=this.velX,this.y+=this.velY,this.x<t.left?(this.x=t.left,this.velX=0):this.x+this.size>t.right&&(this.x=t.right-this.size,this.velX=0),this.y<t.top?(this.y=t.top,this.velY=0):this.y+this.size>t.bottom&&(this.y=t.bottom-this.size,this.velY=0)}render(t,e=!0){if(t.fillStyle="white",t.lineWidth=.5,t.drawImage(this.texture,this.sx,this.sy,this.srcSize,this.srcSize,this.x,this.y,this.size,this.size),t.strokeRect(this.x,this.y,this.size,this.size),e){let e=Math.floor(this.size/3);t.font=e+'px "Exo 2"',t.lineWidth=5;let{width:i}=t.measureText(this.label),s=this.x+i/2+4,n=this.y+this.size/6+2;t.strokeText(this.label,s,n),t.fillText(this.label,s,n)}}getIntoPositionNow(t){null!=this._destX&&(this.x=this._destX,this._destX=null,this.velX&&t.createSpark(this.x,this.y,"h",-Math.sign(this.velX)),this.velX=0),null!=this._destY&&(this.y=this._destY,this._destY=null,this.velY&&t.createSpark(this.x,this.y,"v",-Math.sign(this.velY)),this.velY=0)}}const u=31;class p{constructor(){this.piece=null,this.row=null,this.col=null,this.pieceOffsetX=null,this.pieceOffsetY=null,this.concern=[],this.moveAxis=null}onCoordstart(t,e){let{startX:i,startY:s}=t,[n,h]=e.rowColOfBlank,[o,l]=e.getRowColAt(i,s);n==o?(this.moveAxis="h",this.concern=e.getVector(n,"row")):h==l&&(this.moveAxis="v",this.concern=e.getVector(h,"col")),this.row=o,this.col=l,this.piece=e.getPieceAt(o,l),this.pieceOffsetX=i-this.piece.x,this.pieceOffsetY=s-this.piece.y}onCoordend(t,e){let{startX:i,startY:s,endX:n,endY:h,startTime:o,endTime:l}=t,r="h"==this.moveAxis?n-i:h-s;l-o<300&&Math.abs(r)<u?this.updateModelThenView(e):this.updateModelByView(e),this.piece=null,this.moveAxis=null}updateModelThenView(t){const e=[],i="h"==this.moveAxis?this.row*t.size:this.col,s="h"==this.moveAxis?1:t.size;for(let n=0;n<t.size;n++){let h=i+s*n;e[n]=t.puzzleModel[h]}const n=this.piece.tag,h=e.indexOf(n),o=e.indexOf(t.blankTag);e.splice(o,1),e.splice(h,0,t.blankTag);for(let n=0;n<t.size;n++){let h=i+s*n;t.puzzleModel[h]=e[n];let o=t.pieces[e[n]],[l,r]=[Math.floor(h/t.size),h%t.size],[c,d]=a(l,r,t.len,t.left,t.top,t.size);o.destX=c,o.destY=d}}competitionPosition({left:t,top:e,len:i,size:s,blankTag:n}){let h={},o=Array(s);const[l,r]="h"==this.moveAxis?["x","velX"]:["y","velY"];for(const h of this.concern){if(h.tag==n||h==this.piece)continue;const[l,r]=h.whereami(t,e,i,s);o["h"==this.moveAxis?r:l]=h}const[a,c]=this.piece.evaluatePosition(t,e,i,s),d="h"==this.moveAxis?c:a,u=Math.sign(this.piece[r]);if(o[d]){let t=d;for(;o[t]&&t>=0&&t<s;)t+=u;if(t>=0&&t<s){for(let e=t;e!=d;e-=u)o[e]=o[e-u];o[d]=this.piece}else o[d-u]=this.piece}else o[d]=this.piece;const p="h"==this.moveAxis?this.row*s:this.col,f="h"==this.moveAxis?1:s;for(let i=0;i<s;i++){let l=p+f*i;if(o[i]){const n=o[i];let r=Math.floor(l/s),a=l%s;h[l]=n.tag,n.destX=t+a*n.size,n.destY=e+r*n.size}else h[l]=n}return h}staticPosition({left:t,top:e,len:i,size:s,blankTag:n}){let h={};for(const o of this.concern){if(o.tag==n)continue;let[l,r]=o.whereami(t,e,i,s);h[l*s+r]=o.tag,o.destX=t+r*o.size,o.destY=e+l*o.size}const o="h"==this.moveAxis?this.row*s:this.col,l="h"==this.moveAxis?1:s;for(let t=0;t<s;t++){let e=o+l*t;if(!(e in h)){h[e]=n;break}}return h}updateModelByView(t){let e=this.competitionPosition(t);for(const i in e){const s=e[i];t.puzzleModel[i]=s}}update(t,e){if("h"==this.moveAxis&&null!=e.beforeX){let t=e.x-this.pieceOffsetX;this.piece.velX=t-this.piece.x}else if("v"==this.moveAxis&&null!=e.beforeY){let t=e.y-this.pieceOffsetY;this.piece.velY=t-this.piece.y}this.resolveCollision(t)}resolveCollision(t){const e=t.blankTag,i=this.concern.length,s="h"==this.moveAxis?this.col:this.row,[n,h]="h"==this.moveAxis?["x","velX"]:["y","velY"],o=this.piece[h],l=Math.sign(o);if(0!=l){for(let t=s;t>=0&&t<i;t+=l){const s=this.concern[t];if(s.tag!=e)for(let o=t+l;o>=0&&o<i;o+=l){const t=this.concern[o];t.tag!=e&&(d.willHit(s,t,this.moveAxis)&&(t[n]=s[n]+s[h]+t.size*l))}}let o;o="h"==this.moveAxis?l<0?t.left:t.right-this.piece.size:l<0?t.top:t.bottom-this.piece.size;const[r,a]=l<0?[0,i]:[i-1,-1];for(let e=r;e!=a;e-=l){if(this.concern[e].tag==t.blankTag)continue;const i=this.concern[e];(i[n]+i[h]-o)*l>0&&(i[n]=o,i[h]=0,o+=this.piece.size*-l)}}}}class f{constructor(t,e,i){this.startTime=null,this.endTime=null,this.currentTime=0,this.y=i/2,this.left=t,this.width=e,this.height=i}set width(t){this._width=t,this.w_3=t/3,this.w_6=t/6,this.p=this.w_6-t/25,this.q=this.w_6+t/25}set height(t){this._height=t,this.fontSize=t-1}start(t){this.startTime=t,this.endTime=null}end(t){this.endTime=t}reset(){this.startTime=null,this.endTime=null,this.currentTime=null}update(t){this.currentTime=t}render(t){let{y:e,left:i,w_3:s,w_6:n,p:h,q:o}=this;t.clearRect(i,0,this._width,this._height),t.font=this.fontSize+'px "Exo 2"';let[l,r,a]=function(t){let e=Math.round(t/10),i=Math.floor(e/6e3),s=(e%6e3).toString(),n=s.length;if(n<4){let t=Array(4-n);t.fill("0"),s=t.join("")+s}let h=i.toString(),o=h.length;if(o<2){let t=Array(2-o);t.fill("0"),h=t.join("")+h}return[h,s.substr(0,2),s.substr(2,2)]}(this.currentTime-this.startTime);t.lineWidth=4,t.textAlign="center",t.strokeText(l,i+n,e),t.strokeText("'",i+s,e),t.strokeText('"',i+2*s,e),t.fillText(l,i+n,e),t.fillText("'",i+s,e),t.fillText('"',i+2*s,e),t.textAlign="right",t.strokeText(r[0],i+s+n,e),t.strokeText(a[0],i+2*s+n,e),t.fillText(r[0],i+s+n,e),t.fillText(a[0],i+2*s+n,e),t.textAlign="left",t.strokeText(r[1],i+s+n,e),t.strokeText(a[1],i+2*s+n,e),t.fillText(r[1],i+s+n,e),t.fillText(a[1],i+2*s+n,e)}}const m=20,g=20,v=.75,z=.125,x=50,y=15,b=50,w=25,M=1,_=0;class X{constructor(t,e,i,s,n){this.life=m,this.x=t,this.y=e,this.len=i,this.axis=s,this.direction=n;const h=Math.floor(i/10);let[o,l]="h"==s?[n*g,0]:[0,n*g];this.particles=Array.from(Array(h),()=>{let h,r,a=Math.random()*i,[c,d]="h"==s?[t+n*g,e+a]:[t+a,e+n*g];return"h"==s?(h=o+(Math.random()-.5)*g*1.5,r=l+(a-i/2)/5):(h=o+(a-i/2)/5,r=l+(Math.random()-.5)*g*1.5),{x:c,y:d,velX:h,velY:r}})}update(t){for(const t of this.particles)t.x+=t.velX,t.y+=t.velY,t.velY+=v,t.velX-=Math.sign(t.velX)*z;this.life--}renderParticles(t){const e=t.strokeStyle,i=t.lineCap;t.strokeStyle=function(t){let e=1-t/m;return`hsl(${x+(y-x)*e}, 100%, ${b+(w-b)*e}%, ${M+(_-M)*e})`}(this.life),t.lineWidth=5,t.lineCap="round";for(const e of this.particles){const{x:i,y:s,velX:n,velY:h}=e;t.beginPath(),t.moveTo(i,s),t.lineTo(i-2*n,s-2*h),t.stroke()}t.strokeStyle=e,t.lineCap=i}renderFireball(t){const e=t.fillStyle;let i=this.x,s=this.y,n=Math.abs(this.life/m),h=n*n*this.direction*this.len/4,o="h"==this.axis?t.createLinearGradient(i+h,s,i,s):t.createLinearGradient(i,s+h,i,s);o.addColorStop(0,"#000000"),o.addColorStop(.3,"#884310"),o.addColorStop(.7,"#FFCE58"),o.addColorStop(1,"#FFFFFF"),t.fillStyle=o,"h"==this.axis?t.fillRect(i,s,h,this.len):t.fillRect(i,s,this.len,h),t.fillStyle=e}render(t){t.globalCompositeOperation="screen",this.renderParticles(t),this.renderFireball(t),t.globalCompositeOperation="source-over"}get invalid(){return this.life<0}}function Y(t,e){for(;;){let i=Math.floor(Math.random()*t.length);if(t[i]!=e)return i}}function k(t,e){let i=t.indexOf(e),s=Math.sqrt(t.length),n=Math.floor(i/s),h=0;for(let i=0;i<t.length;i++)if(t[i]!=e)for(let s=i+1;s<t.length;s++)t[s]!=e&&t[i]>t[s]&&h++;return(h+(s%2==0?n+1:0))%2==0}class S{constructor(t,e,i,s,n,h,o){this.playing=!1,this.blankTag=0,this.showLabel=!1,this._bottomBlank=!0,this._rightBlank=!1,this._upsideDown=!1,this.grab=new p,this.sprites=[],this.messageQueue=[],this.handlePlay=this._noop,this.completeHandlers=[],this.left=i,this.top=s,this.len=n,this.timer=new f(i,h,o),this.viewWidth=2*i+n,this.viewHeight=2*s+n+o,this._size=t,this.setPuzzleSet(e)}get right(){return this.left+this.len}get bottom(){return this.top+this.len}get size(){return this._size}get pieceSize(){return this.len/this._size}get rowColOfBlank(){let t=this.puzzleModel.indexOf(this.blankTag);return[Math.floor(t/this._size),t%this._size]}assignLabel(t){this._upsideDown=t;const e=this._size*this._size;for(let i=0;i<e;i++){let e=Math.floor(i/this._size),s=i%this._size,n=(t?this._size-e-1:e)*this._size+s+1;this.pieces[i].label=n.toString()}}setSize(t,e,i){this.end(null),this.timer.reset(),this._size=t,this._bottomBlank=e,this._rightBlank=i;const s=t*t;this.puzzleModel=new Array(s),this.pieces=new Array(s);const n=this._puzzleSet.size/t;for(let e=0;e<s;e++){this.puzzleModel[e]=e;let i=Math.floor(e/t),s=e%t,[h,o]=a(i,s,this._puzzleSet.size,this._puzzleSet.left,this._puzzleSet.top,t);this.pieces[e]=new d(e,this._puzzleSet.texture,h,o,n,this.len/t)}this.blankTag=this._size*(this._size-1)*Number(e)+(this._size-1)*Number(i),this.assignLabel(this._upsideDown),this.initPiecePosition()}setPuzzleSet(t){this._puzzleSet=t,this.solvable=t.solvable,this.setSize(this._size,this._bottomBlank,this._rightBlank)}shuffle(){do{if(this.puzzleModel.sort(()=>.5-Math.random()),k(this.puzzleModel,this.blankTag)!=this.solvable){let t,e=Y(this.puzzleModel,this.blankTag);do{t=Y(this.puzzleModel,this.blankTag)}while(e==t);let i=this.puzzleModel[e];this.puzzleModel[e]=this.puzzleModel[t],this.puzzleModel[t]=i}}while(this.isSolved())}initPiecePosition(){const t=this._size*this._size,e=this._size,i=this.len;for(let s=0;s<t;s++){const t=this.puzzleModel[s];let n=Math.floor(s/e),h=s%e,o=this.pieces[t];o.x=this.left+h*i/e,o.y=this.top+n*i/e,o.destX=null,o.destY=null,o.velX=0,o.velY=0}}getRowColAt(t,e){return r(t,e,this.len,this.left,this.top,this._size)}getPieceAt(t,e){let i=e+t*this._size,s=this.puzzleModel[i];return this.pieces[s]}getVector(t,e){let i,s,n=new Array(this._size);switch(e){case"row":i=t*this._size,s=1;break;case"col":i=t,s=this._size}for(let t=0;t<this._size;t++)n[t]=this.pieces[this.puzzleModel[i+s*t]];return n}createSpark(t,e,i,s){const n=this.len/this.size;-1==s&&("h"==i?t+=n:"v"==i&&(e+=n)),this.sprites.push(new X(t,e,n,i,s))}acceptCoordinate(t,e){if(t<this.left||t>this.right||e<this.top||e>this.bottom)return!1;let[i,s]=this.rowColOfBlank,[n,h]=this.getRowColAt(t,e);return i==n!=(s==h)}push(t){this.messageQueue.unshift(t)}dispatchAll(){let t;for(;null!=(t=this.messageQueue.pop());)switch(t.type){case"mousedown":case"touchstart":this.dispatchCoordstart(t);break;case"mouseup":case"touchend":this.dispatchCoordend(t)}}dispatchCoordstart(t){if(this.acceptCoordinate(t.startX,t.startY)){this.grab.onCoordstart(t,this);for(const t of this.pieces)t.tag!=this.blankTag&&t.getIntoPositionNow(this)}}dispatchCoordend(t){this.grab.piece&&this.grab.onCoordend(t,this)}_noop(){}_updateForPlaying(t){this.isSolved()?this.onComplete(t):this.timer.update(t)}start(t){this.handlePlay=this._updateForPlaying,this.playing=!0,this.timer.start(t)}end(t){this.handlePlay=this._noop,this.playing=!1,this.timer.end(t)}checkBeforeEnd(){return!this.playing||window.confirm("설정을 변경하면 현재 진행 중인 게임이 종료됩니다.\n게임을 중단하고 설정을 변경할까요?")}isSolved(){for(let t=0;t<this.puzzleModel.length;t++)if(this.puzzleModel[t]!=t)return!1;return!0}onComplete(t){this.end(t);for(const t of this.completeHandlers)t()}update(t,e){this.handlePlay(t),this.grab.piece&&e&&this.grab.update(this,e);for(const t of this.grab.concern)t.tag!=this.blankTag&&t.update(this);for(let t=0;t<this.sprites.length;t++){const e=this.sprites[t];e.update(this),e.invalid&&(this.sprites.splice(t,1),t--)}}render(t){t.clearRect(0,0,this.viewWidth,this.viewHeight);for(const e of this.pieces)e.tag!=this.blankTag&&e.render(t,this.showLabel);for(const e of this.sprites)e.render(t)}}class T{get x(){return this.currentX}get y(){return this.currentY}get beforeX(){return this._beforeX}get beforeY(){return this._beforeY}get moveX(){return null!=this.beforeX&&null!=this.currentX?this.currentX-this._beforeX:0}get moveY(){return null!=this.beforeY&&null!=this.currentY?this.currentY-this._beforeY:0}input(t,e){this.inputX=t,this.inputY=e}shim(t,e){this.currentX=t,this.currentY=e}pulse(){this._beforeX=this.currentX,this._beforeY=this.currentY,this.currentX=this.inputX,this.currentY=this.inputY}}class E{disconnect(){document.removeEventListener("mousedown",this.mouse),document.removeEventListener("touchstart",this.touch)}open(){this.mouse=t=>{this.whenItsMouse(t),this.disconnect()},this.touch=t=>{this.whenItsTouch(t),this.disconnect()},document.addEventListener("mousedown",this.mouse),document.addEventListener("touchstart",this.touch,{passive:!1})}}class L{constructor(){this.messageCache=[],this.coordinate=new T,this.onstart=t=>{t.preventDefault();let e=t.offsetX*this.scale,i=t.offsetY*this.scale,s=t.button,n=t.timeStamp;return this.coordinate.shim(e,i),this.coordinate.input(e,i),this.listener.push({type:"mousedown",id:s,startX:e,startY:i,startTime:n}),this.messageCache[s]={type:"mouseup",id:s,startX:e,startY:i,startTime:n},!1},this.onmove=t=>{this.coordinate.input(t.offsetX*this.scale,t.offsetY*this.scale)},this.onend=t=>{let e=t.offsetX*this.scale,i=t.offsetY*this.scale,s=this.messageCache[t.button];delete this.messageCache[t.button],s&&(s.endX=e,s.endY=i,s.endTime=t.timeStamp,this.listener.push(s),this.coordinate.input(e,i))}}connect(t,e,i=1){this.disconnect(),this.source=t,this.listener=e,this.scale=i,this.source.addEventListener("mousedown",this.onstart),this.source.addEventListener("mousemove",this.onmove),document.addEventListener("mouseup",this.onend)}disconnect(){let t=this.source;t&&(t.removeEventListener("mousedown",this.onstart),t.removeEventListener("mousemove",this.onmove),document.removeEventListener("mouseup",this.onend)),this.source=null,this.listener=null}update(){this.listener.dispatchAll(),this.coordinate.pulse()}}class B{constructor(){this.messageCache=[],this.touchStateMap=[],this.coord=null,this.scale=1,this.onstart=t=>{t.preventDefault();const e=t.timeStamp;let i=t.changedTouches;for(const t of i){let i=(t.pageX-this.sourceLeft)*this.scale,s=(t.pageY-this.sourceTop)*this.scale,n=t.identifier,h=new T;h.input(i,s),h.shim(i,s),this.touchStateMap[n]=h,this.coord||(this.coord=h),this.listener.push({type:"touchstart",id:n,startX:i,startY:s,startTime:e}),this.messageCache[n]={type:"touchend",id:n,startX:i,startY:s,startTime:e}}return!1},this.onmove=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const t=this.touchStateMap[e.identifier];let i=(e.pageX-this.sourceLeft)*this.scale,s=(e.pageY-this.sourceTop)*this.scale;t.input(i,s)}},this.onend=t=>{for(const e of t.changedTouches)if(e.identifier in this.touchStateMap){const i=this.touchStateMap[e.identifier],s=(e.pageX-this.sourceLeft)*this.scale,n=(e.pageY-this.sourceTop)*this.scale,h=this.messageCache[e.identifier];if(delete this.messageCache[e.identifier],h.endX=s,h.endY=n,h.endTime=t.timeStamp,this.listener.push(h),i.input(s,n),delete this.touchStateMap[e.identifier],this.coord==i){this.coord=null;for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.coord=this.touchStateMap[t];break}}}}}get coordinate(){return this.coord}connect(t,e,i=1){this.disconnect(),this.source=t,this.listener=e,this.scale=i,this.source.addEventListener("touchstart",this.onstart),this.source.addEventListener("touchmove",this.onmove),document.addEventListener("touchend",this.onend);let{left:s,top:n}=t.getBoundingClientRect();this.sourceLeft=s,this.sourceTop=n}disconnect(){let t=this.source;t&&(t.removeEventListener("touchstart",this.onstart),t.removeEventListener("touchmove",this.onmove),document.removeEventListener("touchend",this.onend)),this.source=null,this.listener=null}update(){this.listener.dispatchAll();for(const t in this.touchStateMap)if(this.touchStateMap.hasOwnProperty(t)){this.touchStateMap[t].pulse()}}}var C=function(t,e,i,s){return new(i||(i=Promise))((function(n,h){function o(t){try{r(s.next(t))}catch(t){h(t)}}function l(t){try{r(s.throw(t))}catch(t){h(t)}}function r(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,l)}r((s=s.apply(t,e||[])).next())}))};let A,P,I,O,F,R;const D=document.getElementById("start"),j=document.getElementById("stop"),H=document.getElementById("next"),V=document.getElementById("random"),N=document.getElementById("puzzle-preview"),W=document.getElementById("game-canvas"),q=document.getElementById("preview-canvas"),Q=document.getElementById("timer-canvas"),$=W.getContext("2d"),G=q.getContext("2d"),J=Q.getContext("2d"),K=W.width-40,U=Q.width-40,Z=Q.height,tt=document.getElementById("story");$.textAlign="center",$.textBaseline="middle",J.textBaseline="middle",J.fillStyle="#FFFFFF";const et=document.getElementById("config"),it=document.getElementById("article");document.getElementById("show-config").addEventListener("click",t=>{et.hidden=!et.hidden}),document.getElementById("config-close").addEventListener("click",t=>{et.hidden=!0}),document.getElementById("show-info").addEventListener("click",t=>{window.scrollTo({top:it.getBoundingClientRect().top-20,behavior:"smooth"})});const st=document.getElementById("size-decrease"),nt=document.getElementById("size-increase"),ht=document.getElementById("size-view");let ot=3;const lt=document.getElementById("puzzle-selector"),rt={topLeft:document.getElementById("blank-pos-top-left"),topRight:document.getElementById("blank-pos-top-right"),bottomLeft:document.getElementById("blank-pos-bottom-left"),bottomRight:document.getElementById("blank-pos-bottom-right")};function at(){return[rt.bottomLeft.checked||rt.bottomRight.checked,rt.topRight.checked||rt.bottomRight.checked]}const ct={none:document.getElementById("show-label-none"),phone:document.getElementById("show-label-phone"),keypad:document.getElementById("show-label-keypad")};function dt(){D.hidden=!1,D.innerText="시작하기",j.hidden=!0,H.hidden=!0,V.hidden=!1}function ut(){D.hidden=!1,D.innerText="다시하기",j.hidden=!0,H.hidden=!1,V.hidden=!1}function pt({texture:t,left:e,top:i,size:s}){let{width:n,height:h}=q;G.clearRect(0,0,n,h),G.drawImage(t,e,i,s,s,0,0,n,h)}function ft(){N.hidden=!0,tt.hidden=!1,F&&(tt.innerText=F.story)}function mt(){N.hidden=!1,tt.hidden=!0}function gt(t,e,i){A.setSize(t,e,i),dt(),mt()}function vt(t){if(!A.checkBeforeEnd())return t.preventDefault(),!1;gt(ot,...at())}function zt(t){A.end(null),A.shuffle(),A.initPiecePosition(),A.start(t),D.hidden=!0,j.hidden=!1,H.hidden=!0,V.hidden=!0,mt()}function xt(t){let e,i=Number(lt.value);do{e=Math.floor(Math.random()*lt.length),F=R[e]}while(!F.solvable||i==e);lt.value=e.toString()}(function(){return C(this,void 0,void 0,(function*(){const t=[],e=yield fetch("puzzleset.json"),i=yield e.json();for(let e=0;e<i.length;e++){const n=i[e];n.__proto__=s.prototype,t.push(n);const h=document.createElement("option");h.value=e.toString(),h.innerText=n.title,lt.appendChild(h)}return yield Promise.all(t.map(t=>t.waitForImageLoad())),t}))})().then(t=>{R=t,D.addEventListener("click",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;zt(t.timeStamp)}),j.addEventListener("click",t=>{A.end(t.timeStamp),dt()}),H.addEventListener("click",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;!function(t){let e=Number(lt.value);do{e=(e+1)%lt.length,F=R[e]}while(!F.solvable);lt.value=e.toString()}(),A.setPuzzleSet(F),pt(F),zt(t.timeStamp)}),V.addEventListener("click",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;xt(),A.setPuzzleSet(F),pt(F),zt(t.timeStamp)}),rt.topLeft.addEventListener("input",vt),rt.topRight.addEventListener("input",vt),rt.bottomLeft.addEventListener("input",vt),rt.bottomRight.addEventListener("input",vt),st.addEventListener("click",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;ot-=1,nt.disabled=!1,ht.innerText=ot.toString(),3==ot&&(st.disabled=!0),gt(ot,...at())}),nt.addEventListener("click",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;ot+=1,st.disabled=!1,ht.innerText=ot.toString(),9==ot&&(nt.disabled=!0),gt(ot,...at())}),lt.addEventListener("change",t=>{if(!A.checkBeforeEnd())return t.preventDefault(),!1;F=R[lt.value],A.setPuzzleSet(F),pt(F),dt(),mt()}),ct.none.addEventListener("input",t=>{A.showLabel=!1}),ct.phone.addEventListener("input",t=>{A.showLabel=!0,A.assignLabel(!1)}),ct.keypad.addEventListener("input",t=>{A.showLabel=!0,A.assignLabel(!0)}),F=t[lt.value],xt(),A=new S(ot,F,20,20,K,U,Z),A.completeHandlers.push(ut,ft),pt(F);let e=W.width/W.getBoundingClientRect().width;P=new n(t=>{A.update(t),A.render($),A.timer.render(J)});let i=t=>{O.update(),A.update(t,O.coordinate),A.render($),A.timer.render(J)};P.start(),I=new E,I.whenItsMouse=t=>{O=new L,O.connect(W,A,e),P.update=i,t.target==W&&O.onstart(t)},I.whenItsTouch=t=>{O=new B,O.connect(W,A,e),P.update=i,t.target==W&&O.onstart(t)},I.open()})}]);